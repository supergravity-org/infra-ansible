---

- name: ensure that the data directory exists
  file: "path={{ data_dir | mandatory }} state=directory"
  tags: elasticsearch

- name: copy over the elasticsearch config
  copy: "src=elasticsearch.yml dest={{ data_dir }}/elasticsearch.yml"
  tags: elasticsearch

- name: install pip
  apt: name=python-pip

- name: install docker-py
  pip: name=docker-py version=1.3.1

- name: start docker image
  docker:
    name: "{{ container_name }}"
    image: "{{ container_image }}"
    state: started
    restart_policy: always
    ports:
      - "0.0.0.0:9200:9200"
      - "0.0.0.0:9300:9300"
    volumes:
    - "{{data_dir}}:/data"

- name: ensure that elasticsearch is running
  wait_for: port=9200 delay=5 timeout=600
  tags: elasticsearch
